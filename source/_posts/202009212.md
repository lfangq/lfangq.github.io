---
title: 高性能JavaScript
date: 2020-09-21 10:01:52
tags: [javascript, book]
---
### 一、加载和运行
#### 非阻塞脚本
等页面完成加载之后，再加载JavaScript源码。从技术角度，这意味着在window的load事件发出之后开始下载代码。
实现方法：
* 延期脚本：`<script>`标签定义`defer`属性(该属性只被IE4和Firefox3.5更高版本支持)
* 动态创建：`<script>`元素, 用它下载并执行代码：
<!-- more -->
```javascript
function loadScript(url, callback){
  var script = document.createElement ("script")
  script.type = "text/javascript";
  if (script.readyState){ //IE
    script.onreadystatechange = function(){
      if (script.readyState == "loaded" || script.readyState == "complete"){
        script.onreadystatechange = null;
        callback();
      }
    };
  } else { //Others
    script.onload = function(){
      callback();
    };
  }
  script.src = url;
  document.getElementsByTagName_r("head")[0].appendChild(script);
}
```
> 所有主流浏览器除firefox和opera保证脚本按照指定的顺序执行。其他浏览器按照服务器返回他们的次序下载并运行
* 用XHR对象下载代码，并注入到页面中：
```
var xhr = new XMLHttpRequest();
xhr.open("get", "file1.js", true);
xhr.onreadystatechange = function(){
  if (xhr.readyState == 4){
    if (xhr.status >= 200 && xhr.status < 300 || xhr.status == 304){
      var script = document.createElement ("script");
      script.type = "text/javascript";
      script.text = xhr.responseText;
      document.body.appendChild(script);
    }
  }
};
xhr.send(null);
```
#### 推荐的非阻塞脚本
1. 
```
<script type="text/javascript" src="loader.js"></script>
<script type="text/javascript">
  loadScript("the-rest.js", function(){
    Application.init();
  });
</script>
```
将此代码放置在body的关闭标签</body>之前，让DOM创建之后，在加载javascript脚本
2. 直接将loadScript()函数嵌入在页面中
```
<script type="text/javascript">
function loadScript(url, callback){
  var script = document.createElement ("script")
  script.type = "text/javascript";
  if (script.readyState){ //IE
    script.onreadystatechange = function(){
      if (script.readyState == "loaded" ||
        script.readyState == "complete"){
        script.onreadystatechange = null;
        callback();
      }
    };
  } else { //Others
    script.onload = function(){
      callback();
    };
  }
  script.src = url;
  document.getElementsByTagName_r("head")[0].appendChild(script);
}
loadScript("the-rest.js", function(){
  Application.init();
});
</script>
```
#### loadScript库
* LazyLoad库
* LABjs库
### 二、数据访问
#### 四种基本的数据位置
* 直接量：直接量代表自己，而不存储于特定位置。直接量包括：字符串、数字、布尔值、对象、数组、函数、正则代表式、具有特殊含义的空值、以及未定义。
* 变量：var关键字用于存储数据值。
* 数组项：具有数组索引，存储一个JavaScript数组对象
* 对象成员：具有字符串索引，存储一个JavaScript对象
#### 管理作用域
* 作用域链：每一个JavaScript函数都表示为对象，进一步说，它是一个函数实例。函数对象正如其他对象，拥有你可以编程访问的属性，和一系列不能被程序访问，仅供JavaScript引擎使用的内部属性。其中一个内部属性是[[Scope]],内部[Scope]属性包含一个函数被创建的作用域中对象的集合，此集合被称为函数的作用域链。
> 注意：在运行期上下文的作用域链中，一个标识符所处的位置越深，它的读写速度就越慢。在没有优化JavaScript引擎的浏览器中，最好尽可能使用局部变量，一个好的经验法则：用局部变量存储本地范围之外的变量值，如果它们在函数中的使用多于一次。
#### 改变作用域链的方法
* with表达式 (不推荐，会导致数据泄漏和性能下降)
* try-catch表达式的catch子语句
#### 动态作用域 (Dynamic Scopes)
* with表达式 (不推荐，会导致数据泄漏和性能下降)
* try-catch表达式的catch子语句
* 包含()的函数
#### 闭包、作用域、内存
* 闭包与性能影响
```javascript
function assignEvents(){
  var id = "xdi9592";
  document.getElementById("save-btn").onclick = function(event){
    saveDocument(id);
  };
}
```
#### 原形
#### 原形链


